log file is ../test-logs/test.sh-20160220-144016.txt
Sat Feb 20 14:40:16 JST 2016
Darwin iMac.local 13.4.0 Darwin Kernel Version 13.4.0: Sun Aug 17 19:50:11 PDT 2014; root:xnu-2422.115.4~1/RELEASE_X86_64 x86_64
Software:

    System Software Overview:

      System Version: OS X 10.9.5 (13F34)
      Kernel Version: Darwin 13.4.0
      Boot Volume: Mac OS 10.9 64GB
      Boot Mode: Normal
      Computer Name: iMac
      User Name: Zou Hanya (hanyazou)
      Secure Virtual Memory: Enabled
      Time since boot: 2:40

TERM_PROGRAM=Apple_Terminal
TERM=xterm-256color
SHELL=/bin/bash
TMPDIR=/var/folders/w4/__dhx9fj1m94624xs_73mdkh0000gn/T/
Apple_PubSub_Socket_Render=/tmp/launch-AorD1e/Render
TERM_PROGRAM_VERSION=326
TERM_SESSION_ID=E04046BD-4680-4013-943B-4474DAD03DBD
USER=hanyazou
SSH_AUTH_SOCK=/tmp/launch-xlMh6N/Listeners
__CF_USER_TEXT_ENCODING=0x1F5:0:0
__CHECKFIX1436934=1
PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
PWD=/Users/hanyazou/github/libfreenect2-hanyazou/build
HOME=/Users/hanyazou
SHLVL=2
LOGNAME=hanyazou
LC_CTYPE=UTF-8
_=/usr/bin/env
----------
$ cat ../test.sh
#!/bin/bash

show_env()
{
    date
    uname -a
    system_profiler SPSoftwareDataType
    env
    echo ----------
    echo '$' cat $0
    cat $0
    echo ----------
    echo '$ git log'
    git log | head -6
    echo '$ git diff'
    git diff | cat
    echo ----------
}

expand()
{
    local pattern='\([0-9]*\)\(-\([0-9]*\)\)*\(,\([0-9]*\)\)*'
    local i
    local j

    for i in $*; do
        local start=`echo "$i" | sed "s/$pattern/\1/"`
        local end=`echo "$i" | sed "s/$pattern/\3/"`
        local step=`echo "$i" | sed "s/$pattern/\5/"`
        if [ "$step". == . ]; then
            step=1
        fi
        if [ "$end". == . ]; then
            echo $i
        else
            j=$start
            while [ $j -le $end ]; do
                echo $j
                let "j += $step"
            done
        fi
    done
}

reset()
{
    echo "#### RESET"
    ./bin/Protonect --force_reset_all_devices --exit
    sleep 5
}

error_detected()
{
    echo "#### ERROR"
    let "error = $error + 1"
    reset
}

test()
{
    date
    echo $*
    #$* > output 2>&1 &
    $* 2>&1 &
    pid=$!
    wait=$((RANDOM % 3 + 4)).$((RANDOM % 100))
    echo sleep $wait
    sleep $wait
    #kill -KILL $pid
    #kill -INT $pid || tail output
    kill -INT $pid || error_detected
    ( sleep 10; kill $pid ) &
    killer_pid=$!
    wait $pid
    kill $killer_pid || error_detected
    sleep 1
    if system_profiler SPUSBDataType | grep Xbox; then
	:
    else
	echo "#### NO DEVICE"
	sleep 4 # wait for the device back
        let "reboot = $reboot + 1"
    fi
}

try=500
try=20
skip="153 154 185 253"
skip="153 154 253 158 159 160 162"
exits="1 10 101 102 103 104 105 106 107 108 109 110 111 112 113 20 201 202 203 204 205 206 207 208 209"
exits="1001-1099 1100-1199,2 1200-1500,5"
exits="2001-2199,1"
exits="1001-1099,2"
skip="253"
exits="999"
exits=`expand $exits`

for exit in $exits; do
  eval "reboot$exit=?"
  eval "error$exit=?"
done

LOG_FILE=`dirname $0`/test-logs/`basename $0`-`date '+%Y%m%d-%H%M%S'`.txt
{
echo log file is $LOG_FILE
show_env
reset
start_time=`date '+%s'`
progress=0
all=0
for j in $exits; do
  let "all = $all + 1"
done
let "all = $all * $try"
for exit in $exits; do
  i=0
  reboot=0
  error=0
  while [ $i -lt $try ]; do
    test ./bin/Protonect --debug_flags $skip $exit cl -noviewer
    let "i = $i + 1"
    let "progress = $progress + 1"
    eval "reboot$exit=$reboot"
    eval "error$exit=$error"
    echo ===================================
    for j in $exits; do
      eval "t=\$reboot$j"
      if [ $t. != '?.' ]; then
        eval "printf \"%4d: %4d / %-4d err=%-4d \" $j \$reboot$j $try \$error$j"
	eval "let \"rate = \$reboot$j * 50 / $try\""
        rate_s=`printf "%${rate}s" | tr " " "*"`
	printf "|%-50s|\n" "$rate_s"
      fi
    done
    let "cur_time = `date '+%s'` - $start_time"
    let "est_end_time = $cur_time * $all / $progress"
    echo
    echo "skip=$skip, exit at $exit"
    printf "#### %6d / %-6d : " $progress $all
    printf "%2dh%02dm / %2dh%02dm " $(($cur_time / 3600)) $(($cur_time / 60 % 60 )) $(($est_end_time / 3600)) $(($est_end_time / 60 % 60))
    printf "(%3d%%) " $(($progress * 100 / $all))
    printf "\n"
    echo ===================================
  done
done

} 2>&1 | tee ${LOG_FILE}
----------
$ git log
commit ec3847d590b838783177c72fe1c2a17577e1c2d8
Author: Zou Hanya <hanyazou@Zous-iMac.local>
Date:   Sat Feb 20 12:55:55 2016 +0900

    debug_flags 253 999 is OK on 10.9.5 w/o VMware, Chrome, Xcode and USBProber

$ git diff
diff --git a/test.sh b/test.sh
index 258b121..9f1b29d 100644
--- a/test.sh
+++ b/test.sh
@@ -84,7 +84,7 @@ test()
 }
 
 try=500
-try=100
+try=20
 skip="153 154 185 253"
 skip="153 154 253 158 159 160 162"
 exits="1 10 101 102 103 104 105 106 107 108 109 110 111 112 113 20 201 202 203 204 205 206 207 208 209"
----------
#### RESET
Version: 0.2.0
Environment variables: LOGFILE=<protonect.log>
Usage: ./bin/Protonect [gl | cl | cpu] [<device serial>]
        [-noviewer] [-norgb | -nodepth] [-help] [-version]
To pause and unpause: pkill -USR1 Protonect
Unknown argument: --exit
[Info] [Freenect2Impl] force reset all devices...
[Info] [Freenect2Impl] Kinect Super Speed HUB port: @21:1 OFF
[Info] [Freenect2Impl] Kinect Super Speed HUB port: @21:1 ON
[Info] [Freenect2Impl] enumerating devices...
